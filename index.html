<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Room Generator</title>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
    }
    #controls {
      width: 250px;
      padding: 1rem;
      background: #f4f4f4;
      border-right: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #renderCanvas {
      flex: 1;
      width: 100%;
      height: 100%;
      display: block;
    }
    label {
      display: flex;
      justify-content: space-between;
    }
    input {
      width: 100px;
    }
    button {
      padding: 0.5rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="controls">
    <h3>Параметры комнаты</h3>
    <label>
      Floor X:
      <input type="number" id="floorX" value="10" step="1" min="2">
    </label>
    <label>
      Floor Y:
      <input type="number" id="floorY" value="10" step="1" min="2">
    </label>
    <label>
      N Cells:
      <input type="number" id="nCells" value="10" step="1" min="2">
    </label>
    <label>
      Wall Height:
      <input type="number" id="wallHeight" value="3" step="0.1" min="1">
    </label>
    <label>
      Perlin Size X:
      <input type="number" id="perlinX" value="1.0" step="0.1">
    </label>
    <label>
      Perlin Size Y:
      <input type="number" id="perlinY" value="1.0" step="0.1">
    </label>
    <label>
      Perlin Size Z:
      <input type="number" id="perlinZ" value="2.0" step="0.1">
    </label>
    <label>
  Min SubRoom Size:
  <input type="number" id="minRoomSize" value="5" step="1" min="1">
</label>
<label>
  Max SubRooms:
  <input type="number" id="maxSubRooms" value="6" step="1" min="1">
</label>
    <button id="generateBtn">Сгенерировать</button>
  </div>
  <canvas id="renderCanvas"></canvas>

  <!-- Babylon.js -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script type="module">
    import { CONFIG } from "./app/config.js";
    import { generateRoom } from "./app/generator.js";
    import { renderRoom } from "./app/renderer.js";

    let engine, scene;

    function generateAndRender() {
      // Обновляем конфиг
      CONFIG.FLOOR_SIZE.x = parseFloat(document.getElementById("floorX").value);
      CONFIG.FLOOR_SIZE.y = parseFloat(document.getElementById("floorY").value);
      CONFIG.N_CELLS = parseInt(document.getElementById("nCells").value, 10);
      CONFIG.WALL_HEIGHT = parseFloat(document.getElementById("wallHeight").value);
      CONFIG.PERLIN.sizeX = parseFloat(document.getElementById("perlinX").value);
      CONFIG.PERLIN.sizeY = parseFloat(document.getElementById("perlinY").value);
      CONFIG.PERLIN.sizeZ = parseFloat(document.getElementById("perlinZ").value);
      CONFIG.MIN_ROOM_SIZE = parseInt(document.getElementById("minRoomSize").value);
      CONFIG.MAX_SUBROOMS = parseInt(document.getElementById("maxSubRooms").value);



      // Чистим старую сцену
      if (engine) {
        engine.dispose();
      }

      const canvas = document.getElementById("renderCanvas");
      const roomJson = generateRoom();
      ({ engine, scene } = renderRoom(canvas, roomJson));
    }

    document.getElementById("generateBtn").addEventListener("click", generateAndRender);

    // Первая генерация
    generateAndRender();
  </script>
</body>
</html>
